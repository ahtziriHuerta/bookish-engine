{% extends 'base.html' %}
{% load static %}
{% block title %}Punto de Venta - Cajero{% endblock %}

{% block content %}
<!-- Estilos y scripts -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="{% static 'tasks/css/escaner.css' %}">
<link rel="stylesheet" href="{% static 'tasks/css/cajero.css' %}">

<script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{% static 'tasks/js/escaner.js' %}" defer></script>
<script src="{% static 'tasks/js/cajero.js' %}" defer></script>

<!-- Contenido principal -->
<div class="container">
  <div class="products-panel">
    <h2>Productos</h2>
    <div class="grid" id="products">
      {% for producto in productos %}
      <div class="product {% if producto.stock == 0 %}sin-stock{% endif %}"
           data-id="{{ producto.id }}"
           data-name="{{ producto.nombre }}"
           data-price="{{ producto.precio }}"
           data-stock="{{ producto.stock }}"
           data-codigo="{{ producto.codigo_barras }}">
        {% if producto.imagen %}
          <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}">
        {% else %}
          <img src="{% static 'img/default.png' %}" alt="default">
        {% endif %}
        <p>{{ producto.nombre }}</p>
        <span>${{ producto.precio }}</span>
        <p class="stock-info {% if producto.stock == 0 %}agotado{% endif %}">
          {% if producto.stock == 0 %}Agotado{% else %}Disponibles: {{ producto.stock }}{% endif %}
        </p>
      </div>
      {% endfor %}
    </div>
    <input type="text" id="codigoManual" placeholder="C√≥digo de barras">
    <button onclick="buscarProductoManual()" class="btn">Buscar producto</button>
    <button onclick="abrirEscaner()" class="btn">Escanear c√≥digo</button>
  </div>

  <div class="ticket-panel">
    <h2>Ticket</h2>
    <ul id="ticket-list"></ul>
    <div class="summary">
      <p>Descuento: <span id="discount">$0.00</span></p>
      <p>Iva: <span id="tax">$0.00</span></p>
      <p class="total">Total: <span id="total">$0.00</span></p>
      <div style="margin-top: 20px;">
        <label>Efectivo recibido:</label><br>
        <input type="text" id="efectivo" placeholder="$0.00" inputmode="decimal" pattern="[0-9]*" onclick="toggleNumpad()" oninput="calcularCambio()">
        <p>Cambio: <span id="cambio">$0.00</span></p>
        <div style="margin-top: 15px;">
          <label for="metodo-pago">M√©todo de pago:</label><br>
          <select id="metodo-pago">
            <option value="efectivo">Efectivo</option>
            <option value="tarjeta">Tarjeta</option>
            <option value="transferencia">Transferencia</option>
            <option value="vales">Vales</option>
          </select>
        </div>
      </div>
      <button onclick="vistaPreviaTicket()" class="btn">Terminar</button>
    </div>
  </div>
</div>

<!-- Modal para esc√°ner -->
<div id="modalEscaner">
  <div id="modalContent">
    <h3>Escanea un producto</h3>

    <div id="scanner-loading">üîÑ Activando c√°mara...</div>

    <div id="scanner-container"></div>

    <button onclick="cerrarEscaner()">Cerrar</button>
  </div>
</div>

<!-- Teclado num√©rico -->
<div class="numpad-panel" id="numpad-panel" style="display: none;">
  <div class="numpad">
    <button onclick="addDigit('1')">1</button>
    <button onclick="addDigit('2')">2</button>
    <button onclick="addDigit('3')">3</button>
    <button onclick="addDigit('4')">4</button>
    <button onclick="addDigit('5')">5</button>
    <button onclick="addDigit('6')">6</button>
    <button onclick="addDigit('7')">7</button>
    <button onclick="addDigit('8')">8</button>
    <button onclick="addDigit('9')">9</button>
    <button onclick="addDigit('.')">.</button>
    <button onclick="addDigit('0')">0</button>
    <button onclick="backspace()">‚Üê</button>
  </div>
</div>
{% endblock %}
