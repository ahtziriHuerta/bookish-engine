<!--
{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Punto de Venta - Cajero</title>
  <link rel="stylesheet" href="{% static 'tasks/css/escaner.css' %}">
  <link rel="stylesheet" href="{% static 'tasks/css/cajero.css' %}">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
  <script src="{% static 'tasks/js/escaner.js' %}" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
</head>

<body>
  
<nav class="navbar navbar-expand-lg navbar-dark">
  <div style="max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; align-items: center; justify-content: space-between;">
    <a class="navbar-brand" href="{% url 'home' %}">Tienda Corozo</a>
    <div id="navbarNav">
      <ul class="navbar-nav" style="display: flex; flex-direction: row; list-style: none; margin: 0; padding: 0;">
        <li class="nav-item"><a class="nav-link" href="{% url 'cajero_dashboard' %}">Caja</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'escanear_producto' %}">Escanear</a></li>
       
      </ul>
    </div>
  </div>
</nav>



  <div class="container">
    <div class="products-panel">
      <h2>Productos</h2>
      <div class="grid" id="products">
        {% for producto in productos %}
        <div class="product {% if producto.stock == 0 %}sin-stock{% endif %}"
             data-name="{{ producto.nombre }}" data-price="{{ producto.precio }}" data-stock="{{ producto.stock }}"
             data-id="{{ producto.id }}">
          {% if producto.imagen %}
            <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}">
          {% else %}
            <img src="{% static 'img/default.png' %}" alt="default">
          {% endif %}
          <p>{{ producto.nombre }}</p>
          <span>${{ producto.precio }}</span>
          <p class="stock-info {% if producto.stock == 0 %}agotado{% endif %}">
            {% if producto.stock == 0 %}Agotado{% else %}Disponibles: {{ producto.stock }}{% endif %}
          </p>
        </div>
        {% endfor %}
      </div>
      <input type="text" id="codigoManual" placeholder="Código de barras">
      <button onclick="buscarProductoManual()" class="btn">Buscar producto</button>
      <button onclick="abrirEscaner()" class="btn">Escanear código</button>
    </div>

    <div class="ticket-panel">
      <h2>Ticket</h2>
      <ul id="ticket-list"></ul>
      <div class="summary">
        <p>Descuento: <span id="discount">$0.00</span></p>
        <p>Iva: <span id="tax">$0.00</span></p>
        <p class="total">Total: <span id="total">$0.00</span></p>
        <div style="margin-top: 20px;">
          <label>Efectivo recibido:</label><br>
          <input type="text" id="efectivo" placeholder="$0.00" inputmode="decimal" pattern="[0-9]*" oninput="calcularCambio()">
          <p>Cambio: <span id="cambio">$0.00</span></p>
          <div style="margin-top: 15px;">
            <label for="metodo-pago">Método de pago:</label><br>
            <select id="metodo-pago">
              <option value="efectivo">Efectivo</option>
              <option value="tarjeta">Tarjeta</option>
              <option value="transferencia">Transferencia</option>
              <option value="vales">Vales</option>
            </select>
          </div>
        </div>
        <button onclick="vistaPreviaTicket()" class="btn">Terminar</button>
      </div>
    </div>
  </div>


  <div id="modalEscaner">
    <div id="modalContent">
      <h3>Escanea un producto</h3>
      <div id="scanner-container"></div>
      <button onclick="cerrarEscaner()" class="btn">Cerrar</button>
    </div>
  </div>

  <div class="numpad-panel" id="numpad-panel" style="display: none;">
    <div class="numpad">
      <button onclick="addDigit('1')">1</button>
      <button onclick="addDigit('2')">2</button>
      <button onclick="addDigit('3')">3</button>
      <button onclick="addDigit('4')">4</button>
      <button onclick="addDigit('5')">5</button>
      <button onclick="addDigit('6')">6</button>
      <button onclick="addDigit('7')">7</button>
      <button onclick="addDigit('8')">8</button>
      <button onclick="addDigit('9')">9</button>
      <button onclick="clearPassword()">C</button>
      <button onclick="addDigit('0')">0</button>
      <button onclick="backspace()">←</button>
    </div>
  </div>
  

  <script>
    function insertarNumero(numero) {
      const input = document.getElementById("codigoManual");
      input.value += numero;
    }

    function borrarUltimoCaracter() {
      const input = document.getElementById("codigoManual");
      input.value = input.value.slice(0, -1);
    }

    function calcularCambio() {
      const total = parseFloat(document.getElementById('total').innerText.replace('$', ''));
      const efectivo = parseFloat(document.getElementById('efectivo').value || 0);
      const cambio = efectivo - total;
      document.getElementById('cambio').innerText = `$${cambio.toFixed(2)}`;
    }

    function buscarProductoManual() {
      const codigo = document.getElementById('codigoManual').value;
      if (!codigo) {
        alert('Por favor ingrese un código de barras');
        return;
      }

      // Lógica para buscar el producto por el código
      alert('Buscando producto con código: ' + codigo);
    }

    function abrirEscaner() {
      document.getElementById('modalEscaner').style.display = 'flex';
      iniciarEscaner();
    }

    function cerrarEscaner() {
      document.getElementById('modalEscaner').style.display = 'none';
      detenerEscaner();
    }

    function iniciarEscaner() {
      // Código para iniciar el escáner con Quagga
      Quagga.init({
        inputStream: {
          name: 'Live',
          type: 'LiveStream',
          constraints: {
            facingMode: 'environment'
          }
        },
        decoder: {
          readers: ['ean_reader', 'ean_8_reader', 'code_128_reader']
        }
      }, function(err) {
        if (err) {
          console.log(err);
          return;
        }
        Quagga.start();
      });

      Quagga.onDetected(function(data) {
        console.log(data);
        const codigo = data.codeResult.code;
        document.getElementById('codigoManual').value = codigo;
      });
    }

    function detenerEscaner() {
      Quagga.stop();
    }
  </script>
</body>
</html>
-->